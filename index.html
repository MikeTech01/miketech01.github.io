<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Michael Alibeaj ‚Äî M.Sc. Computer Science</title>
<meta name="description" content="Portfolio and contact for Michael Alibeaj, M.Sc. Computer Science ‚Äî Big Data & Data Science Student." />
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 100 100%27><rect width=%27100%27 height=%27100%27 rx=%2712%27 fill=%27%23232F3E%27/><text x=%2750%25%27 y=%2757%25%27 text-anchor=%27middle%27 font-size=%2746%27 fill=%27%23FF9900%27 font-family=%27Arial%27>MA</text></svg>">

<!-- Inter font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<!-- GoatCounter analytics -->
<script data-goatcounter="https://miketech01.goatcounter.com/count" async src="https://gc.zgo.at/count.js"></script>

<style>
:root{
  --navy:#232F3E; --navy-2:#1B2532; --ink:#F5F7FB; --muted:#D6DEEE;
  --line:#2e3a4a; --blue:#146EB4; --orange:#FF9900;
  --card:#1e2836; --railbg:#1B2532; --bg0:#101723; --bg1:#0c131b;
  --chart-axis:#2e3a4a; --chart-text:#ffffff; --chart-label:#D6DEEE;
  --radius:14px; --max:1360px; --rail:290px;
  --shadow:0 10px 28px rgba(0,0,0,.25);
  --font: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;color:var(--ink);font:17px/1.65 var(--font);
  background:linear-gradient(180deg,var(--bg0),var(--navy) 50%,var(--bg1));
  transition: background-color .35s ease, color .35s ease;
}
a{color:#9ccdfb;text-decoration:none}
a:hover{text-decoration:underline}

/* Toggle buttons */
#toggle-rail,#theme-toggle{
  position:fixed;top:16px;z-index:10010;width:42px;height:42px;border-radius:10px;
  border:1px solid #3a4a5f;background:#243142;color:#e9f2ff;
  font-size:18px;display:grid;place-items:center;box-shadow:0 10px 24px rgba(0,0,0,.25);
  cursor:pointer;transition:background .35s ease,color .35s ease;
}
#toggle-rail{left:16px;} #theme-toggle{right:16px;}
#toggle-rail:focus-visible,#theme-toggle:focus-visible{ outline:3px solid rgba(20,110,180,.45); outline-offset:2px }

/* Layout */
.page{max-width:var(--max);margin:0 auto;display:grid;
  grid-template-columns:var(--rail) 1fr;gap:28px;padding:28px}
.rail{position:sticky;top:0;align-self:start;height:max-content;
  padding:22px;border:1px solid var(--line);border-radius:var(--radius);
  background:var(--railbg);box-shadow:var(--shadow);}
.name{display:flex;align-items:center;gap:12px}
.badge{width:48px;height:48px;border-radius:10px;display:grid;place-items:center;font-weight:900;color:#0f172a;
  background:linear-gradient(180deg,#ffd89a 0%,#ffb347 60%),linear-gradient(90deg,#4aa3e0,#146EB4);
  border:1px solid #39485b;}
.role{color:var(--muted);opacity:.92;margin:6px 0 12px;font-size:1rem}
.meta{color:#cfe0ff;font-size:.95rem}
.actions a{display:block;text-align:center;margin-top:10px;padding:12px 14px;
  border-radius:10px;border:1px solid #3a4a5f;background:#ffb347;color:#0f172a;font-weight:800;text-decoration:none}
.actions a.secondary{background:#243142;color:#e9f2ff;font-weight:700}
nav{margin-top:16px;border-top:1px solid var(--line);padding-top:12px}
nav a{display:block;padding:8px 0;color:#d7e5ff}
nav a.active{color:#fff;font-weight:800}

/* Collapsed sidebar (for toggle) */
body.sidebar-collapsed .page { grid-template-columns: 1fr; }
body.sidebar-collapsed .rail { display: none; }

/* Fancy CTA (keeps shine) */
.cta{
  --h:54px;
  display:inline-flex;align-items:center;justify-content:center;gap:10px;
  min-width:220px;height:var(--h);padding:0 22px;
  border-radius:12px;border:1px solid #3a4a5f;cursor:pointer;
  background:linear-gradient(180deg,#ffb347 0%,#ff9900 70%);
  color:#0f172a;font-weight:900;font-size:17px;
  box-shadow:0 10px 22px rgba(255,153,0,.28),inset 0 1px 0 rgba(255,255,255,.35);
  position:relative;text-decoration:none;user-select:none;
  transition:transform .18s ease,box-shadow .18s ease,filter .18s ease;
}
.cta:hover{transform:translateY(-2px);box-shadow:0 16px 28px rgba(255,153,0,.32),inset 0 1px 0 rgba(255,255,255,.4);}
.cta:active{transform:translateY(0);box-shadow:0 8px 16px rgba(255,153,0,.28)}
.cta .ico{display:inline-grid;place-items:center;width:22px;height:22px}
.cta .hint{opacity:.75;font-weight:700;font-size:15px}
.cta::after{
  content:"";position:absolute;inset:-2px;border-radius:12px;
  background:linear-gradient(120deg,rgba(255,255,255,.0) 0%,rgba(255,255,255,.45) 35%,rgba(255,255,255,.0) 70%);
  transform:translateX(-120%);filter:blur(.5px);
  transition:transform .7s cubic-bezier(.2,.6,.2,1);mix-blend-mode:overlay;
}
.cta:hover::after{transform:translateX(120%)}

/* Sections */
.title,section.panel{border:1px solid var(--line);border-radius:var(--radius);background:var(--card);box-shadow:var(--shadow);}
.title{padding:20px;}
section.panel{padding:24px 20px;margin-top:16px;}
.title h1{margin:0;font-size:clamp(24px,3.4vw,36px);color:#fff}
.title p{margin:8px 0 0;color:#eaf2ff;opacity:.95}
section h2{margin:0 0 10px;font-size:18px;text-transform:uppercase;color:#dbe7ff}
.list{margin:10px 0 0;padding-left:18px;color:#e6eeff}
footer{text-align:center;color:#c6d1e3;font-size:15px;margin-top:12px}


/* Snapshot */
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:10px}
.kpi{border:1px solid var(--line);border-radius:12px;background:#233042;padding:16px;min-height:110px;position:relative;overflow:hidden}
.kpi.good::after{content:"";position:absolute;inset:-2px;border-radius:12px;padding:1px;background:linear-gradient(135deg,#35d399,#ffb347);
  -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;opacity:.35}
.kpi .label{color:var(--muted);font-size:1.05rem}
.kpi .value{font-size:2rem;font-weight:800;color:#fff;margin-top:4px}
.kpi .delta{font-size:1.05rem;margin-top:2px;color:#cfe0ff}
.kpi.skeleton{color:transparent;background:linear-gradient(90deg,#233042 0,#2a3a4f 50%,#233042 100%);background-size:200% 100%;animation:shimmer 1.1s infinite linear}
@keyframes shimmer{ to { background-position: -200% 0; } }

/* Charts */
.charts{display:grid;grid-template-columns:1fr;gap:18px;margin-top:18px}
.chart-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
figure.chart{border:1px solid var(--line);border-radius:12px;background:var(--card);padding:14px;margin:0}
figure.chart.activity{grid-column:1/-1}
figure.chart h3{margin:0 0 8px;font-size:1.15rem;color:#dbe7ff}
.chart-svg{width:100%;height:300px;display:block}
.chart-legend{color:#cfd8ea;font-size:1.05rem;margin-top:6px}

/* Contact info card */
.info-card{
  border:1px solid var(--line);
  border-radius:12px;
  background:linear-gradient(180deg,#222f43,#1f2a3d);
  box-shadow:var(--shadow);
  padding:18px;
}
.info-sub{ color:#cfe0ff }
.info-list .row{ display:grid; grid-template-columns:110px 1fr; gap:6px 10px; padding:8px 0; border-top:1px dashed rgba(255,255,255,.06) }
.info-list .row:first-child{ border-top:none }

/* Toast */
.toast{position:fixed;bottom:26px;right:26px;background:#173a2a;color:#d7ffe6;
  padding:12px 14px;border-radius:10px;opacity:0;transform:translateY(16px);
  transition:opacity .35s ease,transform .35s ease;z-index:9999;font-weight:700;}
.toast.show{opacity:1;transform:translateY(0)}

/* LIGHT THEME ‚Äî higher contrast for readability */
body[data-theme="light"]{
  --ink:#0f172a;            /* main text (very dark slate) */
  --muted:#334155;          /* secondary text */
  --bg0:#eef2f7;            /* page gradient top */
  --navy:#f3f6fb;           /* page gradient mid */
  --bg1:#ffffff;            /* page gradient bottom */
  --card:#ffffff;           /* panels/cards */
  --railbg:#ffffff;         /* sidebar card */
  --line:#c8d2e1;           /* borders (a bit darker) */
  --chart-axis:#b7c4d7;
  --chart-text:#0f172a;     /* chart value labels */
  --chart-label:#334155;    /* chart axes labels */
}
body[data-theme="light"] a{ color:#0f62fe; }
body[data-theme="light"] a:hover{ color:#0043ce; }
body[data-theme="light"] .kpi{ background:#f7faff }
body[data-theme="light"] .actions a.secondary{ background:#f3f7ff; color:#0f172a; border-color:#c8d2e1 }
body[data-theme="light"] .info-card{ background:linear-gradient(180deg,#ffffff,#f7f9fc) }
body[data-theme="light"] #toggle-rail,
body[data-theme="light"] #theme-toggle{ background:#f7f9fc; color:#0f172a; border-color:#c8d2e1 }

/* THEMEABLE TEXT (forces all text to follow variables) */
.title h1 { color: var(--ink); }
.title p { color: var(--muted); }
section.panel,
section.panel p,
section.panel li { color: var(--ink); }
.role,
.meta,
.list,
.chart-legend,
.kpi .label,
.kpi .delta,
nav a { color: var(--muted); }
.kpi .value { color: var(--ink); }
.info-card,
.info-card h3 { color: var(--ink); }
.info-sub { color: var(--muted) !important; } /* beats old inline color */

/* Responsive */
@media (max-width:980px){
  .page{grid-template-columns:1fr}
  .rail{position:relative}
  nav{display:flex;gap:12px;flex-wrap:wrap}
  nav a{padding:0}
  .kpis{grid-template-columns:1fr 1fr}
  .charts{grid-template-columns:1fr}
  .chart-grid{grid-template-columns:1fr}
  .chart-svg{height:260px}
}
</style>

<!-- Early theme init (prevents flash) -->
<script>
(function initThemeEarly(){
  try {
    const saved = localStorage.getItem('theme_pref_v1');
    if (saved) {
      document.addEventListener('DOMContentLoaded', () => {
        document.body?.setAttribute('data-theme', saved);
      });
    }
  } catch(e) {}
})();
</script>

</head>
<body data-theme="dark">

<!-- UI controls -->
<button id="toggle-rail" aria-label="Close sidebar" aria-expanded="true" title="Close sidebar">‚úï</button>
<button id="theme-toggle" aria-label="Toggle theme" title="Toggle theme">üåó</button>

<div class="page">
  <aside class="rail">
    <div class="name">
      <div class="badge">MA</div>
      <div>
        <strong>Michael Alibeaj</strong><br/>
        <div class="role">M.Sc. Computer Science ‚Äî Politecnico di Milano</div>
      </div>
    </div>
    <div class="meta">Milan, Italy ¬∑ <a href="mailto:malibeaj01@outlook.com">malibeaj01@outlook.com</a></div>
    <div class="actions">
      <a href="cv.html?from=home">View CV</a>
      <a class="cta" href="contact.html" aria-label="Go to contact form">
        <span class="ico" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M4 6h16v12H4z" stroke="currentColor" stroke-width="2" />
            <path d="M4 7l8 6 8-6" stroke="currentColor" stroke-width="2" />
          </svg>
        </span>
        Contact page
      </a>
      <a class="secondary" href="https://github.com/MikeTech01" target="_blank" rel="noreferrer">GitHub</a>
      <a class="secondary" href="https://www.linkedin.com/in/michael-alibeaj-9810771a6/" target="_blank" rel="noreferrer">LinkedIn</a>
    </div>
    <nav>
      <a href="#about" class="active">About</a>
      <a href="#metrics">Snapshot</a>
      <a href="#awards">Awards</a>
      <a href="contact.html">Contact</a>
    </nav>
  </aside>

  <main>
    <div class="title">
      <h1>Big Data & Data Science ‚Äî Student Portfolio</h1>
      <p>Focused on Python/SQL data modeling and visualization that enable clear, confident decisions.</p>
    </div>

<section id="about" class="panel">
  <h2>About</h2>
  <p>
    I‚Äôm a Computer Science M.Sc. student at Politecnico di Milano specializing in Big Data, AI, and Data Science.
  <p>
    My goal is to bridge data engineering and data science to deliver reliable, data-driven tools that improve decision-making.
    I‚Äôm passionate about performance optimization, real-world ML applications, and building end-to-end analytics systems that are both robust and interpretable.
  </p>
</section>



      <section id="awards" class="panel">
        <h2>Awards & Achievements</h2>
        <ul class="list">
    <li><strong>DMFW Challenge:</strong> Awarded 1st Place.</li>
    <li><strong>AN2DL Challenge:</strong> Awarded 2nd Place.</li>
    <li><strong> Italian Mathematical Olympiad  Regional Qualifier:</strong> Ranked in the top 10% in the Italian Mathematical Olympiad among 500+ participants.</li>
  </ul>
</section>

    <section id="metrics" class="panel">
      <h2>Snapshot</h2>
      <div class="kpis">
        <div class="kpi skeleton"><div class="label">Projects</div><div class="value" id="kpi-projects">‚Äî</div><div class="delta" id="kpi-projects-delta">loading‚Ä¶</div></div>
        <div class="kpi skeleton"><div class="label">Stars</div><div class="value" id="kpi-stars">‚Äî</div><div class="delta" id="kpi-stars-delta">loading‚Ä¶</div></div>
        <div class="kpi skeleton"><div class="label">README Coverage</div><div class="value" id="kpi-readme">‚Äî</div><div class="delta" id="kpi-readme-note">loading‚Ä¶</div></div>
      </div>

      <div class="charts">
        <figure class="chart activity">
          <h3>Activity by Month (last 12)</h3>
          <svg id="monthchart" class="chart-svg" viewBox="0 0 700 300" preserveAspectRatio="xMidYMid meet"></svg>
          <div class="chart-legend" id="month-legend">Repos updated per month</div>
        </figure>
        <div class="chart-grid">
          <figure class="chart">
            <h3>Skill Focus (from repos)</h3>
            <svg id="langchart" class="chart-svg" viewBox="0 0 700 300" preserveAspectRatio="xMidYMid meet"></svg>
            <div class="chart-legend">Top repository languages</div>
          </figure>
          <figure class="chart">
            <h3>Top Repos by Stars</h3>
            <svg id="topstars" class="chart-svg" viewBox="0 0 700 300" preserveAspectRatio="xMidYMid meet"></svg>
            <div class="chart-legend">Top 3 public repos</div>
          </figure>
          <figure class="chart">
            <h3>Featured (Top 3)</h3>
            <div class="chart-legend">
              <ul id="featured-list" style="margin:0;padding-left:18px;font-size:1rem;line-height:1.5"></ul>
            </div>
          </figure>
          <figure class="chart">
            <h3>API Status</h3>
            <div class="chart-legend" id="api-status">Fetching GitHub data‚Ä¶</div>
          </figure>
        </div>
      </div>
    </section>

    <section id="contact" class="panel">
      <h2>Contact</h2>
      <div class="info-card" style="display:flex;justify-content:space-between;align-items:center;gap:14px">
        <div>
          <h3 style="margin:0 0 6px">Let‚Äôs talk</h3>
          <p class="info-sub" style="margin:0">Prefer email? I usually reply within 24 hours.</p>
          <dl class="info-list" style="margin-top:10px">
            <div class="row"><dt>Email</dt><dd><a href="mailto:malibeaj01@outlook.com">malibeaj01@outlook.com</a></dd></div>
            <div class="row"><dt>GitHub</dt><dd><a href="https://github.com/MikeTech01" target="_blank" rel="noreferrer">github.com/MikeTech01</a></dd></div>
            <div class="row"><dt>LinkedIn</dt><dd><a href="https://www.linkedin.com/in/michael-alibeaj-9810771a6/" target="_blank" rel="noreferrer">/in/michael-alibeaj-9810771a6/</a></dd></div>
            <div class="row"><dt>Location</dt><dd>Milan, Italy (CET/CEST)</dd></div>
          </dl>
        </div>
        <a class="cta cta-xl" href="contact.html" aria-label="Open contact form page">
          <span class="ico" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path d="M4 6h16v12H4z" stroke="currentColor" stroke-width="2" />
              <path d="M4 7l8 6 8-6" stroke="currentColor" stroke-width="2" />
            </svg>
          </span>
          Contact page <span class="hint">‚Üµ opens form</span>
        </a>
      </div>
    </section>

    <footer style="margin-top:16px">
      <div class="footer-icons" style="display:flex;gap:14px;justify-content:center;margin-bottom:8px">
        <a href="https://github.com/MikeTech01" target="_blank" rel="noreferrer" title="GitHub" aria-label="GitHub">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .5a12 12 0 0 0-3.79 23.4c.6.11.82-.26.82-.58 0-.29-.01-1.06-.02-2.09-3.34.73-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.09-.74.08-.73.08-.73 1.21.09 1.84 1.25 1.84 1.25 1.07 1.83 2.8 1.3 3.48.99.11-.78.42-1.3.76-1.6-2.66-.3-5.47-1.33-5.47-5.94 0-1.31.47-2.38 1.24-3.22-.12-.3-.54-1.52.12-3.17 0 0 1.01-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.29-1.55 3.3-1.23 3.3-1.23.66 1.65.24 2.87.12 3.17.77.84 1.24 1.91 1.24 3.22 0 4.62-2.81 5.64-5.49 5.93.43.37.81 1.1.81 2.22 0 1.6-.01 2.89-.01 3.29 0 .32.21.69.83.57A12 12 0 0 0 12 .5z"/></svg>
        </a>
        <a href="https://www.linkedin.com/in/michael-alibeaj-9810771a6/" target="_blank" rel="noreferrer" title="LinkedIn" aria-label="LinkedIn">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M20.45 20.45h-3.55v-5.6c0-1.34-.02-3.06-1.86-3.06-1.86 0-2.14 1.45-2.14 2.95v5.71H9.35V9h3.41v1.56h.05c.48-.9 1.66-1.86 3.42-1.86 3.66 0 4.33 2.41 4.33 5.55v6.2zM5.34 7.43A2.06 2.06 0 1 1 5.33 3.3a2.06 2.06 0 0 1 .01 4.12zM7.12 20.45H3.56V9h3.56v11.45z"/></svg>
        </a>
        <a href="mailto:malibeaj01@outlook.com" title="Email" aria-label="Email">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg>
        </a>
      </div>
      ¬© <span id="year"></span> Michael Alibeaj
    </footer>
  </main>
</div>

<!-- Toast after returning from contact page -->
<script>
(function(){
  const params = new URLSearchParams(location.search);
  if (params.get('contact') === 'sent') {
    let toast = document.getElementById('toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast';
      toast.className = 'toast show';
      toast.textContent = 'Thanks! Your message was sent ‚úÖ';
      document.body.appendChild(toast);
    } else {
      toast.textContent = 'Thanks! Your message was sent ‚úÖ';
      toast.classList.add('show');
    }
    setTimeout(()=>toast.classList.remove('show'), 2400);
    const url = new URL(location.href);
    url.searchParams.delete('contact');
    history.replaceState(null, '', url);
  }
})();
</script>

<script>
// Footer year
document.getElementById('year').textContent = new Date().getFullYear();
</script>

<!-- Sidebar + Theme toggle (single, resilient) -->
<script>
(function(){
  const KEY_SIDEBAR='sidebar_collapsed_v1';
  const KEY_THEME='theme_pref_v1';

  function applySidebar(collapsed){
    document.body.classList.toggle('sidebar-collapsed', collapsed);
    const btn = document.getElementById('toggle-rail');
    if (btn) {
      btn.textContent = collapsed ? '‚ò∞' : '‚úï';
      btn.setAttribute('aria-expanded', String(!collapsed));
      btn.setAttribute('aria-label', collapsed ? 'Open sidebar' : 'Close sidebar');
      btn.title = collapsed ? 'Open sidebar' : 'Close sidebar';
    }
  }

  function setTheme(mode){
    document.body.setAttribute('data-theme', mode);
    const btn = document.getElementById('theme-toggle');
    if (btn) btn.textContent = (mode === 'light') ? 'üåô' : 'üåó';
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    const railBtn=document.getElementById('toggle-rail');
    const themeBtn=document.getElementById('theme-toggle');

    // Sidebar init + click
    const savedSb=localStorage.getItem(KEY_SIDEBAR)==='1';
    applySidebar(savedSb);
    if (railBtn) railBtn.addEventListener('click', ()=>{
      const next=!document.body.classList.contains('sidebar-collapsed');
      applySidebar(next);
      try{localStorage.setItem(KEY_SIDEBAR,next?'1':'0')}catch{}
    });

    // Theme init + click
    const savedTheme=localStorage.getItem(KEY_THEME) || (matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
    setTheme(savedTheme);
    if (themeBtn) themeBtn.addEventListener('click', ()=>{
      const next=(document.body.getAttribute('data-theme')==='light')?'dark':'light';
      setTheme(next);
      try{localStorage.setItem(KEY_THEME,next)}catch{}
      // repaint + refresh charts
      document.documentElement.style.transform = 'translateZ(0)';
      requestAnimationFrame(()=>{ document.documentElement.style.transform = ''; });
      setTimeout(()=>window.renderSnapshot && window.renderSnapshot(true),150);
    });

    // Shortcuts
    window.addEventListener('keydown', (e)=>{
      if(/input|textarea|select/i.test(e.target.tagName)) return;
      if(e.key==='s'||e.key==='S'){ e.preventDefault(); railBtn?.click(); }
      if(e.key==='t'||e.key==='T'){ e.preventDefault(); themeBtn?.click(); }
      if(e.key.toLowerCase()==='c'){ window.location.href='contact.html'; }
    });
  });
})();
</script>

<!-- GitHub Snapshot: data + charts -->
<script>
/* ============== CONFIG ============== */
const GH_USER = 'MikeTech01';
const MAX_HEALTH_REPOS = 15;
const EVENTS_LIMIT = 30;
const CACHE_TTL_MS = 15 * 60 * 1000;

/* ============== UTIL ============== */
const $ = s => document.querySelector(s);
const setText = (sel,val)=>{ const n=$(sel); if(n) n.textContent = val; };
const rmSkel = ()=> document.querySelectorAll('.kpi.skeleton').forEach(k=>k.classList.remove('skeleton'));
const addGood = (el)=>{ const n = el?.closest('.kpi'); if(n) n.classList.add('good'); };
function countTo(el, target, suffix=""){ if(!el) return; const start = +String(el.textContent).replace(/\D/g,'')||0; const dur=800; const t0=performance.now(); const step=t=>{const p=Math.min(1,(t-t0)/dur); el.textContent = Math.round(start+(target-start)*p)+suffix; if(p<1) requestAnimationFrame(step)}; requestAnimationFrame(step); }
const cacheGet = (k,ttl)=>{ try{const v=localStorage.getItem(k); if(!v) return null; const {t,data}=JSON.parse(v); return (Date.now()-t < ttl)?data:null }catch{return null}};
const cacheSet = (k,data)=>{ try{localStorage.setItem(k, JSON.stringify({t:Date.now(), data}))}catch{} };
const fmt = new Intl.NumberFormat('en', { maximumFractionDigits: 0 });
const short = (name,max=26)=> name.length>max ? name.slice(0,max-1)+'‚Ä¶' : name;

// theme-aware chart colors
function chartColors(){
  const cs = getComputedStyle(document.body);
  return {
    axis:  cs.getPropertyValue('--chart-axis').trim()  || '#2e3a4a',
    text:  cs.getPropertyValue('--chart-text').trim()  || '#ffffff',
    label: cs.getPropertyValue('--chart-label').trim() || '#D6DEEE'
  };
}

/* ============== SVG HELPERS ============== */
function drawColumns(svgId, series){
  const svg=document.getElementById(svgId); if(!svg||!series?.length)return;
  while(svg.lastChild) svg.removeChild(svg.lastChild);
  const {axis,text,label} = chartColors();
  const W=700,H=300,L=64,R=28,T=18,B=48;
  const barW=((W-L-R)/series.length)*0.58, gap=((W-L-R)/series.length)*0.42;
  const maxV=Math.max(1,...series.map(s=>s.value));
  const niceMax=Math.max(1, Math.ceil(maxV/5)*5);

  const axisX=document.createElementNS('http://www.w3.org/2000/svg','line');
  axisX.setAttribute('x1',L);axisX.setAttribute('x2',W-R);axisX.setAttribute('y1',H-B);axisX.setAttribute('y2',H-B);
  axisX.setAttribute('stroke',axis);svg.appendChild(axisX);

  series.forEach((s,i)=>{
    const x=L+i*(barW+gap)+gap*0.5;
    const h=(s.value/niceMax)*(H-T-B);
    const y=(H-B)-h;

    const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect.setAttribute('x',x); rect.setAttribute('y',y);
    rect.setAttribute('width',barW); rect.setAttribute('height',h);
    rect.setAttribute('rx','8'); rect.setAttribute('fill',s.color||'#7fb8ff'); rect.setAttribute('opacity','0.94');
    rect.appendChild(document.createElementNS('http://www.w3.org/2000/svg','title')).textContent = `${s.label}: ${fmt.format(s.value)}`;
    svg.appendChild(rect);

    if (s.value > 0){
      const val=document.createElementNS('http://www.w3.org/2000/svg','text');
      val.setAttribute('x',x+barW/2); val.setAttribute('y',y-10);
      val.setAttribute('text-anchor','middle'); val.setAttribute('fill',text); val.setAttribute('font-size','16');
      val.textContent=fmt.format(s.value); svg.appendChild(val);
    }

    const lbl=document.createElementNS('http://www.w3.org/2000/svg','text');
    lbl.setAttribute('x',x+barW/2); lbl.setAttribute('y',H-B+24);
    lbl.setAttribute('text-anchor','middle'); lbl.setAttribute('fill',label); lbl.setAttribute('font-size','15');
    lbl.textContent=s.label; svg.appendChild(lbl);
  });
}

function drawHBars(svgId, series){
  const svg=document.getElementById(svgId); if(!svg||!series?.length)return;
  while(svg.lastChild) svg.removeChild(svg.lastChild);
  const {text,label} = chartColors();
  const W=700,H=300,L=220,R=32,T=24,B=24;
  const rowH = Math.min(50, (H-T-B)/series.length - 12);
  const maxV=Math.max(1,...series.map(s=>s.value));

  series.forEach((s,i)=>{
    const y=T + i*(rowH+14);
    const rawW = (W-L-R)*(s.value/maxV);
    const w = Math.max(s.value>0 ? 10 : 6, rawW);

    const name=document.createElementNS('http://www.w3.org/2000/svg','text');
    name.setAttribute('x',L-14); name.setAttribute('y',y+rowH/2+6);
    name.setAttribute('text-anchor','end'); name.setAttribute('fill',label); name.setAttribute('font-size','15');
    name.textContent=short(s.label); name.appendChild(document.createElementNS('http://www.w3.org/2000/svg','title')).textContent = s.label;
    svg.appendChild(name);

    const r=document.createElementNS('http://www.w3.org/2000/svg','rect');
    r.setAttribute('x',L); r.setAttribute('y',y); r.setAttribute('width',w); r.setAttribute('height',rowH);
    r.setAttribute('rx','8'); r.setAttribute('fill', s.color || '#FF9900'); r.setAttribute('opacity','0.94');
    r.appendChild(document.createElementNS('http://www.w3.org/2000/svg','title')).textContent = `${s.label}: ${fmt.format(s.value)} ‚òÖ`;
    svg.appendChild(r);

    const val=document.createElementNS('http://www.w3.org/2000/svg','text');
    val.setAttribute('x',L+w+10); val.setAttribute('y',y+rowH/2+6);
    val.setAttribute('fill',text); val.setAttribute('font-size','16'); val.textContent=fmt.format(s.value);
    svg.appendChild(val);
  });

  if (series.every(s=>s.value===0)){
    const t=document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x',L); t.setAttribute('y',H/2);
    t.setAttribute('fill',label); t.setAttribute('font-size','15');
    t.textContent='No stars yet ‚Äî add a README & description to attract stars.';
    svg.appendChild(t);
  }
}

/* ============== DATA FETCH ============== */
async function fetchJSON(url){
  const res = await fetch(url, { headers:{'Accept':'application/vnd.github+json'} });
  if(!res.ok) throw new Error(res.status+' '+res.statusText);
  return res.json();
}
async function fetchOwnedRepos(user){
  return (await fetchJSON(`https://api.github.com/users/${user}/repos?per_page=100&type=owner&sort=updated`)).filter(r=>!r.fork);
}
async function fetchEvents(user){
  return fetchJSON(`https://api.github.com/users/${user}/events/public`);
}
async function fetchRepoByFullName(fullName){
  return fetchJSON(`https://api.github.com/repos/${fullName}`);
}
async function hasReadme(owner, repo){
  const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/readme`, { headers:{'Accept':'application/vnd.github+json'} });
  return res.ok;
}
async function hasWorkflows(owner, repo){
  const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/actions/workflows`, { headers:{'Accept':'application/vnd.github+json'} });
  if(!res.ok) return false;
  const j = await res.json();
  return (j.total_count||0) > 0;
}

/* ============== COMBINE OWNED + SHARED ============== */
async function fetchOwnedAndShared(user){
  const [owned, events] = await Promise.all([ fetchOwnedRepos(user), fetchEvents(user) ]);

  const pushed = events.filter(e => e.type === 'PushEvent').slice(0, EVENTS_LIMIT);
  const sharedFullNames = Array.from(new Set(pushed.map(e => e.repo?.name).filter(Boolean)));

  const sharedSubset = sharedFullNames.slice(0, 15);
  const sharedDetails = [];
  for (const full of sharedSubset){
    const rep = await fetchRepoByFullName(full).catch(()=>null);
    if(rep && !rep.fork) sharedDetails.push(rep);
  }

  const byFull = {};
  [...owned, ...sharedDetails].forEach(r => { if(r && r.full_name) byFull[r.full_name] = r; });
  const combined = Object.values(byFull);

  return { owned, combined };
}

/* ============== RENDER ============== */
function monthKey(d){ return d.getUTCFullYear()+'-'+String(d.getUTCMonth()+1).padStart(2,'0'); }
function last12MonthLabels(){
  const names=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const out=[]; const now=new Date(Date.now());
  for(let i=11;i>=0;i--){
    const dt=new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth()-i, 1));
    out.push({key: monthKey(dt), label: names[dt.getUTCMonth()]});
  }
  return out;
}

async function renderSnapshot(forceRedraw=false){
  const cacheKey='gh_snapshot_v12';
  let data = forceRedraw ? (cacheGet(cacheKey, Infinity)) : cacheGet(cacheKey, CACHE_TTL_MS);

  try{
    if(!data){
      const { owned, combined } = await fetchOwnedAndShared(GH_USER);

      const projectsCombined = combined.length;
      const starsOwned = owned.reduce((s,r)=>s+(r.stargazers_count||0),0);

      const months = last12MonthLabels();
      const monthCount = Object.fromEntries(months.map(m=>[m.key,0]));
      combined.forEach(r=>{
        const d = new Date(r.pushed_at || r.updated_at);
        const k = monthKey(d);
        if(monthCount[k] !== undefined) monthCount[k] += 1;
      });
      const monthSeries = months.map((m,i)=>({ label:m.label, value:monthCount[m.key], color: i%2? '#3aa0ff':'#7fb8ff' }));

      const counts={}; combined.forEach(r=>{ const k=r.language||'Other'; counts[k]=(counts[k]||0)+1; });
      const langSeries = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([label,value],i)=>({
        label, value, color: i===0?'#FF9900':i===1?'#3aa0ff':'#7fb8ff'
      }));

      const top3 = combined
        .map(r=>({name:r.name, full:r.full_name, stars:r.stargazers_count||0, html_url:r.html_url}))
        .sort((a,b)=>b.stars-a.stars)
        .slice(0,3);
      const topStarsSeries = top3.map((r,i)=>({label:r.name, value:r.stars, color:i===0?'#FF9900':'#3aa0ff'}));

      const healthSet = combined
        .sort((a,b)=> new Date(b.pushed_at||b.updated_at) - new Date(a.pushed_at||a.updated_at))
        .slice(0, MAX_HEALTH_REPOS);
      let ciOK=0, readmeOK=0;
      for (const r of healthSet){
        const [hasCI, hasRM] = await Promise.all([
          hasWorkflows(r.owner.login, r.name).catch(()=>false),
          hasReadme(r.owner.login, r.name).catch(()=>false),
        ]);
        if(hasCI) ciOK++;
        if(hasRM) readmeOK++;
      }
      const ciPct = healthSet.length ? Math.round(ciOK/healthSet.length*100) : 0;
      const readmePct = healthSet.length ? Math.round(readmeOK/healthSet.length*100) : 0;

      data = {projectsCombined, starsOwned, monthSeries, langSeries, top3, topStarsSeries, ciPct, readmePct};
      cacheSet(cacheKey, data);
    }

    // KPIs
    countTo(document.getElementById('kpi-projects'), data.projectsCombined);
    countTo(document.getElementById('kpi-stars'), data.starsOwned);
    countTo(document.getElementById('kpi-ci'), data.ciPct, '%');
    countTo(document.getElementById('kpi-readme'), data.readmePct, '%');

    setText('#kpi-projects-delta','owner + shared (recent pushes)');
    setText('#kpi-stars-delta','public repo stars (owned)');
    setText('#kpi-ci-note', `Checked top ${MAX_HEALTH_REPOS} repos`);
    setText('#kpi-readme-note', `Checked top ${MAX_HEALTH_REPOS} repos`);

    // visual cues
    if (data.ciPct >= 70) addGood(document.getElementById('kpi-ci'));
    if (data.readmePct >= 80) addGood(document.getElementById('kpi-readme'));

    // Charts
    drawColumns('monthchart', data.monthSeries);
    drawColumns('langchart', data.langSeries);
    drawHBars('topstars', data.topStarsSeries);

    // Featured list
    const UL = document.getElementById('featured-list');
    if (UL){
      UL.innerHTML = '';
      data.top3.forEach(r=>{
        const li = document.createElement('li');
        li.innerHTML = `<a href="${r.html_url}" target="_blank" rel="noreferrer" title="${r.full}">${r.name}</a> ‚Äî ‚≠ê ${r.stars}`;
        UL.appendChild(li);
      });
    }

    setText('#month-legend', 'Repos updated per month (owned + shared, last 12)');
    setText('#api-status', 'GitHub API: OK');

    rmSkel();
  } catch (err){
    console.warn(err);
    setText('#api-status', 'GitHub API error or rate limit ‚Äî showing placeholders.');
    rmSkel();
  }
}

window.renderSnapshot = renderSnapshot;
renderSnapshot();
</script>

</body>
</html>
