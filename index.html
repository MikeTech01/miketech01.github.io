<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Michael Alibeaj — M.Sc. Computer Science</title>
<meta name="description" content="Portfolio and contact for Michael Alibeaj, M.Sc. Computer Science." />
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 100 100%27><rect width=%27100%27 height=%27100%27 rx=%2712%27 fill=%27%23232F3E%27/><text x=%2750%25%27 y=%2757%25%27 text-anchor=%27middle%27 font-size=%2746%27 fill=%27%23FF9900%27 font-family=%27Arial%27>MA</text></svg>">
<style>
:root{
  --navy:#232F3E; --navy-2:#1B2532; --ink:#F5F7FB; --muted:#D6DEEE;
  --line:#2e3a4a; --blue:#146EB4; --orange:#FF9900; --btn-text:#0f172a;
  --radius:14px; --max:1160px; --rail:330px;
  --shadow:0 10px 28px rgba(0,0,0,.25);
  --font:ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;color:var(--ink);font:16px/1.65 var(--font);
  background:linear-gradient(180deg,#101723,var(--navy) 50%,#0c131b);
}
a{color:#9ccdfb;text-decoration:none}
a:hover{text-decoration:underline}
a:focus-visible{outline:3px solid rgba(20,110,180,.45);outline-offset:2px;border-radius:6px}
.page{max-width:var(--max);margin:0 auto;display:grid;
  grid-template-columns:var(--rail) 1fr;gap:28px;padding:28px}
.rail{
  position:sticky;top:0;align-self:start;height:max-content;
  padding:20px;border:1px solid var(--line);border-radius:var(--radius);
  background:var(--navy-2);box-shadow:var(--shadow);
}
.name{display:flex;align-items:center;gap:12px}
.badge{width:44px;height:44px;border-radius:10px;display:grid;place-items:center;font-weight:900;color:var(--btn-text);
  background:linear-gradient(180deg,#ffd89a 0%,#ffb347 60%),linear-gradient(90deg,#4aa3e0,#146EB4);
  border:1px solid #39485b;}
.role{color:#e6eefc;opacity:.92;margin:6px 0 12px}
.meta{color:#cfe0ff;font-size:14px}
.actions a{display:block;text-align:center;margin-top:10px;padding:11px 14px;
  border-radius:10px;border:1px solid #3a4a5f;background:#ffb347;color:var(--btn-text);font-weight:800;text-decoration:none}
.actions a.secondary{background:#243142;color:#e9f2ff;font-weight:600}
nav{margin-top:16px;border-top:1px solid var(--line);padding-top:12px}
nav a{display:block;padding:8px 0;color:#d7e5ff}
nav a.active{color:#ffffff;font-weight:700}
main{min-width:0}
.title{padding:18px 20px;border:1px solid var(--line);border-radius:var(--radius);
  background:#1e2836;box-shadow:var(--shadow)}
.title h1{margin:0;font-size:clamp(22px,3.4vw,34px);letter-spacing:.3px;color:#fff}
.title p{margin:6px 0 0;color:#eaf2ff;opacity:.92}
section.panel{padding:22px 20px;border:1px solid var(--line);border-radius:var(--radius);
  background:#1e2836;box-shadow:var(--shadow);margin-top:16px}
section h2{margin:0 0 8px;font-size:16px;letter-spacing:.2px;text-transform:uppercase;color:#dbe7ff}
.lead{font-size:20px;margin:4px 0 6px}
.muted{color:var(--muted)}
.list{margin:10px 0 0;padding-left:18px;color:#e6eeff}
footer{opacity:.85;color:#c6d1e3;font-size:14px;text-align:center;margin-top:12px}

/* --- Snapshot (KPI + Charts) UPGRADED --- */
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:10px}
.kpi{border:1px solid var(--line);border-radius:12px;background:#233042;padding:14px;min-height:92px;position:relative;overflow:hidden}
.kpi .label{color:var(--muted);font-size:.88rem}
.kpi .value{font-size:1.5rem;font-weight:700;color:#fff;margin-top:2px}
.kpi .delta{font-size:.9rem;margin-top:2px}
.kpi .delta.up{color:#35d399}
.kpi .delta.down{color:#fcae66}
.kpi.skeleton{color:transparent;background:linear-gradient(90deg,#233042 0,#2a3a4f 50%,#233042 100%);background-size:200% 100%;animation:shimmer 1.1s infinite linear}
@keyframes shimmer{to{background-position:-200% 0}}

.charts{display:grid;grid-template-columns:1.1fr 0.9fr;gap:12px;margin-top:12px}
.chart-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
figure.chart{border:1px solid var(--line);border-radius:12px;background:#1e2836;padding:12px;margin:0}
figure.chart h3{margin:0 0 6px;font-size:0.95rem;color:#dbe7ff}
.chart-svg{width:100%;height:180px;display:block}
.chart-legend{color:var(--muted);font-size:.85rem;margin-top:4px}

/* responsive */
@media (max-width:980px){
  .page{grid-template-columns:1fr}
  .rail{position:relative}
  nav{display:flex;gap:12px;flex-wrap:wrap}
  nav a{padding:0}
  .kpis{grid-template-columns:1fr 1fr}
  .charts{grid-template-columns:1fr}
  .chart-grid{grid-template-columns:1fr}
}
@media print{
  body{background:#fff;color:#000}
  .rail,.title,.panel{background:#fff;box-shadow:none;border-color:#e5e7eb}
  .actions,nav a[href^="#"]{display:none}
  a{color:#000;text-decoration:underline}
}
</style>
</head>
<body>
<div class="page">
  <aside class="rail">
    <div class="name">
      <div class="badge" aria-hidden="true">MA</div>
      <div>
        <strong>Michael Alibeaj</strong><br/>
        <div class="role">M.Sc. Computer Science — Politecnico di Milano</div>
      </div>
    </div>
    <div class="meta">Milan, Italy · <a href="mailto:malibeaj01@outlook.com">malibeaj01@outlook.com</a></div>
    <div class="actions">
      <a href="cv.html">View CV</a>
      <a class="secondary" href="https://github.com/MikeTech01" target="_blank" rel="noreferrer">GitHub</a>
      <a class="secondary" href="https://www.linkedin.com/in/michael-alibeaj-9810771a6/" target="_blank" rel="noreferrer">LinkedIn</a>
    </div>
    <nav>
      <a href="#about" class="active">About</a>
      <a href="#skills">Skills</a>
      <a href="#metrics">Snapshot</a>
      <a href="#awards">Awards</a>
      <a href="#contact">Contact</a>
    </nav>
  </aside>

  <main>
    <div class="title">
      <h1>Business Intelligence & Data — Student Portfolio</h1>
      <p>Focused on Python/SQL data modeling and BI that enable clear, confident decisions.</p>
    </div>

    <section id="about" class="panel">
      <h2>About</h2>
      <p class="lead">I turn messy datasets into reliable metrics and readable dashboards.</p>
      <p class="muted">Strengths: Python (Pandas), SQL, pragmatic BI delivery. I care about crisp metric definitions, data quality checks, and shipping insights that non-technical stakeholders can actually use.</p>
      <ul class="list">
        <li>Solid foundations in statistics, performance modeling, and software engineering.</li>
        <li>End-to-end ownership of small data stacks (ingest → transform → validate → publish).</li>
      </ul>
    </section>

    <section id="skills" class="panel">
      <h2>Skills</h2>
      <ul class="list">
        <li><strong>Analytics & BI:</strong> SQL, Power BI, Excel (PowerQuery), Matplotlib</li>
        <li><strong>Data Engineering:</strong> Python (Pandas), ETL/ELT, REST APIs, Git/GitHub</li>
        <li><strong>ML & Statistics:</strong> scikit-learn, TensorFlow/Keras, NLP basics</li>
        <li><strong>Tools & Languages:</strong> GitHub Actions, Linux, English (C1), Italian/Albanian (Native)</li>
      </ul>
    </section>

    <!-- ================= Snapshot ================= -->
    <section id="metrics" class="panel" aria-labelledby="metrics-title">
      <h2 id="metrics-title">Snapshot</h2>

      <!-- KPIs -->
      <div class="kpis" role="list">
        <div class="kpi skeleton" role="listitem" aria-label="Projects">
          <div class="label">Projects</div>
          <div class="value" id="kpi-projects">—</div>
          <div class="delta up" id="kpi-projects-delta">loading…</div>
        </div>
        <div class="kpi skeleton" role="listitem" aria-label="Dashboards">
          <div class="label">Dashboards</div>
          <div class="value" id="kpi-dashboards">—</div>
          <div class="delta up" id="kpi-dashboards-delta">loading…</div>
        </div>
        <div class="kpi skeleton" role="listitem" aria-label="Stars">
          <div class="label">Stars</div>
          <div class="value" id="kpi-stars">—</div>
          <div class="delta up" id="kpi-stars-delta">loading…</div>
        </div>
        <div class="kpi skeleton" role="listitem" aria-label="Goal completion">
          <div class="label">Learning Goal</div>
          <div class="value" id="kpi-goal">—</div>
          <div class="delta" id="kpi-goal-note">goal ≥ 10h</div>
        </div>
      </div>

      <!-- Charts -->
      <div class="charts">
        <figure class="chart">
          <h3>Learning Velocity (weekly commits ≈ hours)</h3>
          <svg id="sparkline" class="chart-svg" viewBox="0 0 600 180" preserveAspectRatio="none"></svg>
          <div class="chart-legend" id="sparkline-legend">Last 10 weeks</div>
        </figure>

        <div class="chart-grid">
          <figure class="chart">
            <h3>Skill Focus (from repos)</h3>
            <svg id="barchart" class="chart-svg" viewBox="0 0 600 180" preserveAspectRatio="none"></svg>
            <div class="chart-legend">Top repository languages</div>
          </figure>

          <figure class="chart">
            <h3>Goal Gauge (this week)</h3>
            <svg id="donut" class="chart-svg" viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet" aria-label="Goal completion donut"></svg>
            <div class="chart-legend">Target 10h · based on public commits</div>
          </figure>

          <figure class="chart">
            <h3>Before vs After (impact)</h3>
            <svg id="beforeAfter" class="chart-svg" viewBox="0 0 600 180" preserveAspectRatio="none"></svg>
            <div class="chart-legend" id="ba-legend">Example: latency reduced (edit values)</div>
          </figure>

          <figure class="chart">
            <h3>API Status</h3>
            <div class="chart-legend" id="api-status">Fetching GitHub data…</div>
          </figure>
        </div>
      </div>
    </section>
    <!-- ============================================ -->

    <section id="awards" class="panel">
      <h2>Awards</h2>
      <ul class="list">
        <li><strong>Data Management for the Web (DMFW)</strong> — 1st Place, Politecnico di Milano</li>
        <li><strong>Artificial Neural Networks & Deep Learning (AN2DL)</strong> — 2nd Place</li>
        <li><strong>Italian Mathematical Olympiad</strong> — Top 10% (Regional)</li>
      </ul>
    </section>

    <section id="contact" class="panel">
      <h2>Contact</h2>
      <p class="muted">Open to Business Intelligence / Data internships — Milan or remote.</p>
      <ul class="list" style="list-style:none;padding-left:0">
        <li>Email: <a href="mailto:malibeaj01@outlook.com">malibeaj01@outlook.com</a></li>
        <li>GitHub: <a href="https://github.com/MikeTech01" target="_blank" rel="noreferrer">github.com/MikeTech01</a></li>
        <li>LinkedIn: <a href="https://www.linkedin.com/in/michael-alibeaj-9810771a6/" target="_blank" rel="noreferrer">linkedin.com/in/michael-alibeaj-9810771a6</a></li>
        <li>Location: Milan, Italy</li>
      </ul>
    </section>

    <footer>© <span id="year"></span> Michael Alibeaj · Built for GitHub Pages</footer>
  </main>
</div>

<!-- Footer scripts -->
<script>
document.getElementById('year').textContent = new Date().getFullYear();
const links = Array.from(document.querySelectorAll('nav a'));
const sections = links.map(a => document.querySelector(a.getAttribute('href')));
const onScroll = () => {
  const y = window.scrollY + 120; let active = 0;
  sections.forEach((s,i)=>{ if(s && s.offsetTop <= y) active = i; });
  links.forEach((a,i)=> a.classList.toggle('active', i===active));
};
document.addEventListener('scroll', onScroll, {passive:true}); onScroll();
</script>

<!-- === GitHub Snapshot Script (live stats) === -->
<script>
/* ==================== CONFIG ==================== */
const GH_USER = 'MikeTech01';        // <-- your GitHub username
const WEEKS_TO_SHOW = 10;
const BI_KEYWORDS = ['bi','business intelligence','dashboard','power bi','quicksight','analytics'];
const HOURS_GOAL = 10;               // weekly learning target

/* ==================== UTIL & DOM ==================== */
const $ = (s)=>document.querySelector(s);
const setText = (sel,val)=>{ const n=$(sel); if(n) n.textContent = val; };
const rmSkel = ()=> document.querySelectorAll('.kpi.skeleton').forEach(k=>k.classList.remove('skeleton'));
const cacheGet = (k,maxAgeMs)=>{ try{const v=localStorage.getItem(k); if(!v) return null; const {t,data}=JSON.parse(v); return (Date.now()-t<maxAgeMs)?data:null;}catch{return null;} };
const cacheSet = (k,data)=>{ try{localStorage.setItem(k, JSON.stringify({t:Date.now(),data}))}catch{} };

/* ==================== SVG DRAWERS ==================== */
function drawSparkline(svgId, data){
  const svg=document.getElementById(svgId); if(!svg||!data?.length) return;
  while(svg.lastChild) svg.removeChild(svg.lastChild);
  const W=600,H=180,L=40,R=20,T=10,B=30,max=Math.max(HOURS_GOAL+4,...data),stepX=(W-L-R)/(data.length-1);

  const addLine=(x1,y1,x2,y2,st='#2e3a4a',dash)=>{ const ln=document.createElementNS('http://www.w3.org/2000/svg','line'); ln.setAttribute('x1',x1);ln.setAttribute('y1',y1);ln.setAttribute('x2',x2);ln.setAttribute('y2',y2);ln.setAttribute('stroke',st); if(dash) ln.setAttribute('stroke-dasharray',dash); svg.appendChild(ln); }
  addLine(L,T,L,H-B); addLine(L,H-B, W-R,H-B);

  const pts=data.map((v,i)=>[L+i*stepX, T+(1-v/max)*(H-T-B)]);
  const d=pts.map((p,i)=>(i?'L':'M')+p[0]+' '+p[1]).join(' ');
  const fillD = d + ` L ${L+(data.length-1)*stepX} ${H-B} L ${L} ${H-B} Z`;

  const defs=document.createElementNS('http://www.w3.org/2000/svg','defs');
  const grad=document.createElementNS('http://www.w3.org/2000/svg','linearGradient');
  grad.id='slGrad'; grad.setAttribute('x1','0'); grad.setAttribute('y1','0'); grad.setAttribute('x2','0'); grad.setAttribute('y2','1');
  const s1=document.createElementNS('http://www.w3.org/2000/svg','stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color','#FF9900');
  const s2=document.createElementNS('http://www.w3.org/2000/svg','stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color','#146EB4'); s2.setAttribute('stop-opacity','0.2');
  grad.append(s1,s2); defs.appendChild(grad); svg.appendChild(defs);

  const fill=document.createElementNS('http://www.w3.org/2000/svg','path'); fill.setAttribute('d',fillD); fill.setAttribute('fill','url(#slGrad)'); fill.setAttribute('opacity','0.28'); svg.appendChild(fill);
  const path=document.createElementNS('http://www.w3.org/2000/svg','path'); path.setAttribute('d',d); path.setAttribute('fill','none'); path.setAttribute('stroke','#FF9900'); path.setAttribute('stroke-width','2.5'); svg.appendChild(path);

  const [lx,ly]=pts[pts.length-1]; const dot=document.createElementNS('http://www.w3.org/2000/svg','circle'); dot.setAttribute('cx',lx); dot.setAttribute('cy',ly); dot.setAttribute('r','4.5'); dot.setAttribute('fill','#FF9900'); svg.appendChild(dot);

  const gy=T+(1-HOURS_GOAL/max)*(H-T-B); addLine(L,gy, W-R,gy, '#3a4a5f', '4 4');
}

function drawBars(svgId, series){
  const svg=document.getElementById(svgId); if(!svg||!series?.length) return;
  while(svg.lastChild) svg.removeChild(svg.lastChild);
  const W=600,H=180,L=40,R=20,T=10,B=30,barW=((W-L-R)/series.length)*0.65,gap=((W-L-R)/series.length)*0.35,maxV=Math.max(1,...series.map(s=>s.value))*1.25;

  const axisX=document.createElementNS('http://www.w3.org/2000/svg','line');
  axisX.setAttribute('x1',L); axisX.setAttribute('x2',W-R); axisX.setAttribute('y1',H-B); axisX.setAttribute('y2',H-B); axisX.setAttribute('stroke','#2e3a4a'); svg.appendChild(axisX);

  series.forEach((s,i)=>{
    const x=L+i*(barW+gap)+gap*0.5, h=(s.value/maxV)*(H-T-B), y=(H-B)-h;
    const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect.setAttribute('x',x); rect.setAttribute('y',y); rect.setAttribute('width',barW); rect.setAttribute('height',h); rect.setAttribute('rx','6'); rect.setAttribute('fill',s.color||'#7fb8ff'); rect.setAttribute('opacity','0.92'); svg.appendChild(rect);

    const label=document.createElementNS('http://www.w3.org/2000/svg','text');
    label.setAttribute('x',x+barW/2); label.setAttribute('y',H-B+16); label.setAttribute('text-anchor','middle'); label.setAttribute('fill','#D6DEEE'); label.setAttribute('font-size','12'); label.textContent=s.label; svg.appendChild(label);

    const val=document.createElementNS('http://www.w3.org/2000/svg','text');
    val.setAttribute('x',x+barW/2); val.setAttribute('y',y-6); val.setAttribute('text-anchor','middle'); val.setAttribute('fill','#ffffff'); val.setAttribute('font-size','12'); val.textContent=s.value+(s.suffix||''); svg.appendChild(val);
  });
}

function drawDonut(svgId, percent){
  const svg=document.getElementById(svgId); if(!svg) return;
  while(svg.lastChild) svg.removeChild(svg.lastChild);
  const cx=100, cy=100, r=70, circ=2*Math.PI*r;
  const bg=document.createElementNS('http://www.w3.org/2000/svg','circle');
  bg.setAttribute('cx',cx); bg.setAttribute('cy',cy); bg.setAttribute('r',r); bg.setAttribute('fill','none'); bg.setAttribute('stroke','#2e3a4a'); bg.setAttribute('stroke-width','16'); svg.appendChild(bg);
  const fg=document.createElementNS('http://www.w3.org/2000/svg','circle');
  fg.setAttribute('cx',cx); fg.setAttribute('cy',cy); fg.setAttribute('r',r); fg.setAttribute('fill','none'); fg.setAttribute('stroke','#FF9900'); fg.setAttribute('stroke-width','16'); fg.setAttribute('stroke-linecap','round');
  fg.setAttribute('stroke-dasharray',`${circ*percent} ${circ}`); fg.setAttribute('transform','rotate(-90 100 100)'); svg.appendChild(fg);
  const t=document.createElementNS('http://www.w3.org/2000/svg','text');
  t.setAttribute('x',cx); t.setAttribute('y',cy+6); t.setAttribute('text-anchor','middle'); t.setAttribute('fill','#ffffff'); t.setAttribute('font-size','22'); t.setAttribute('font-weight','700');
  t.textContent = Math.round(percent*100)+'%'; svg.appendChild(t);
}

function drawBeforeAfter(svgId, beforeVal, afterVal, label='Latency (ms)'){
  const svg=document.getElementById(svgId); if(!svg) return;
  while(svg.lastChild) svg.removeChild(svg.lastChild);
  const W=600,H=180,L=40,R=20,T=20,B=40,max=Math.max(beforeVal,afterVal)*1.15, barW=90, gap=80, yBase=H-B;

  const addBar=(x,val,color)=>{ const h=(val/max)*(H-T-B),y=yBase-h; const r=document.createElementNS('http://www.w3.org/2000/svg','rect'); r.setAttribute('x',x); r.setAttribute('y',y); r.setAttribute('width',barW); r.setAttribute('height',h); r.setAttribute('rx','8'); r.setAttribute('fill',color); r.setAttribute('opacity','0.95'); svg.appendChild(r); return {x,y,h}; };
  const axis=document.createElementNS('http://www.w3.org/2000/svg','line'); axis.setAttribute('x1',L); axis.setAttribute('x2',W-R); axis.setAttribute('y1',yBase); axis.setAttribute('y2',yBase); axis.setAttribute('stroke','#2e3a4a'); svg.appendChild(axis);

  const x1=L+80, x2=x1+barW+gap;
  addBar(x1,beforeVal,'#7fb8ff'); addBar(x2,afterVal,'#FF9900');

  const tx=(x,text,y)=>{ const t=document.createElementNS('http://www.w3.org/2000/svg','text'); t.setAttribute('x',x); t.setAttribute('y',y); t.setAttribute('text-anchor','middle'); t.setAttribute('fill','#D6DEEE'); t.setAttribute('font-size','12'); t.textContent=text; svg.appendChild(t); };
  tx(x1+barW/2,'Before',yBase+16); tx(x2+barW/2,'After',yBase+16);

  const title=document.createElementNS('http://www.w3.org/2000/svg','text'); title.setAttribute('x', (W/2)); title.setAttribute('y', T-6); title.setAttribute('text-anchor','middle'); title.setAttribute('fill','#D6DEEE'); title.setAttribute('font-size','12'); title.textContent=label; svg.appendChild(title);

  const valT=(x,val,y)=>{ const t=document.createElementNS('http://www.w3.org/2000/svg','text'); t.setAttribute('x',x); t.setAttribute('y',y); t.setAttribute('text-anchor','middle'); t.setAttribute('fill','#ffffff'); t.setAttribute('font-size','13'); t.textContent=val; svg.appendChild(t); };
  valT(x1+barW/2, beforeVal, T+16); valT(x2+barW/2, afterVal, T+16);
}

/* ==================== GITHUB FETCHERS ==================== */
async function fetchJSON(url){
  const res = await fetch(url, { headers:{'Accept':'application/vnd.github+json'} });
  if(!res.ok) throw new Error(res.status+' '+res.statusText);
  return res.json();
}
async function fetchRepos(user){
  return (await fetchJSON(`https://api.github.com/users/${user}/repos?per_page=100&type=owner&sort=updated`)).filter(r=>!r.fork);
}
async function fetchEvents(user){
  return fetchJSON(`https://api.github.com/users/${user}/events/public`);
}

/* ==================== RENDER ==================== */
async function renderSnapshot(){
  const cacheKey='gh_snapshot_v1';
  const cached = cacheGet(cacheKey, 1000*60*15); // 15 minutes
  let data = cached;
  try{
    if(!data){
      const [repos, events] = await Promise.all([ fetchRepos(GH_USER), fetchEvents(GH_USER) ]);

      const projects = repos.length;
      const stars = repos.reduce((s,r)=>s+(r.stargazers_count||0),0);
      const dashboards = repos.filter(r=>{
        const blob = `${r.name||''} ${(r.description||'')} ${(r.topics||[]).join(' ')}`.toLowerCase();
        return BI_KEYWORDS.some(k=>blob.includes(k));
      }).length;

      const weeks = Array(WEEKS_TO_SHOW).fill(0);
      const now = new Date();
      const isoWeekStart = (d)=>{ const dt=new Date(d); const day=(dt.getUTCDay()+6)%7; dt.setUTCDate(dt.getUTCDate()-day); dt.setUTCHours(0,0,0,0); return dt; };
      const thisWeek = isoWeekStart(now);
      events.forEach(ev=>{
        if(ev.type!=='PushEvent') return;
        const when = new Date(ev.created_at);
        const ws = isoWeekStart(when);
        const diffDays = (thisWeek - ws)/(1000*60*60*24);
        const idxFromEnd = Math.floor(diffDays/7);
        const bucket = (WEEKS_TO_SHOW-1) - idxFromEnd;
        if(bucket>=0 && bucket<WEEKS_TO_SHOW) weeks[bucket] += (ev?.payload?.size||0);
      });
      const hours = weeks.map(c=>Math.min(15, Math.round(c*1.0))); // 1 commit ≈ 1h
      const thisWeekHours = hours[hours.length-1] || 0;

      const counts={}; repos.forEach(r=>{ const k=r.language||'Other'; counts[k]=(counts[k]||0)+1; });
      const langSeries = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([label,value],i)=>({
        label, value, color: i===0?'#FF9900':i===1?'#3aa0ff':'#7fb8ff'
      }));

      data = {projects, stars, dashboards, hours, thisWeekHours, langSeries};
      cacheSet(cacheKey, data);
    }

    setText('#kpi-projects', data.projects);
    setText('#kpi-dashboards', data.dashboards);
    setText('#kpi-stars', data.stars);
    setText('#kpi-projects-delta', 'from GitHub');
    setText('#kpi-dashboards-delta', data.dashboards ? 'keywords/topics match' : 'no BI-tagged repos yet');
    setText('#kpi-stars-delta', 'public repo stars total');

    const pct = Math.max(0, Math.min(1, data.thisWeekHours / HOURS_GOAL));
    setText('#kpi-goal', Math.round(pct*100)+'%');
    setText('#kpi-goal-note', `${data.thisWeekHours}h / ${HOURS_GOAL}h`);

    rmSkel();

    drawSparkline('sparkline', data.hours);
    drawBars('barchart', data.langSeries);
    drawDonut('donut', pct);

    // EDIT these with a real impact metric (e.g., latency, cost, ETL time)
    drawBeforeAfter('beforeAfter', 950, 620, 'Latency (ms) — Before vs After');
    document.getElementById('ba-legend').textContent = 'Example: −35% latency after pipeline changes';

    const avg = (data.hours.reduce((a,b)=>a+b,0) / (data.hours.length||1)).toFixed(1);
    setText('#sparkline-legend', `Last ${WEEKS_TO_SHOW} weeks · avg ${avg}h/wk`);

    setText('#api-status', 'GitHub API: OK' + (cacheGet('gh_snapshot_v1', 1e12)?' (cached ✓)':''));
  } catch (err){
    console.warn(err);
    setText('#api-status', 'GitHub API error or rate limit — showing placeholders.');
    rmSkel();
  }
}

renderSnapshot();
</script>
</body>
</html>
